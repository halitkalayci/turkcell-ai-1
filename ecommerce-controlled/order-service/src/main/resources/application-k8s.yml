# Kubernetes-specific configuration for order-service
# Activated with: --spring.profiles.active=k8s

server:
  port: ${SERVER_PORT:8082}

spring:
  application:
    name: ${SPRING_APPLICATION_NAME:order-service}
  
  # Database configuration (uses env vars from ConfigMap/Secret)
  datasource:
    url: jdbc:h2:mem:orderdb
    driver-class-name: org.h2.Driver
    username: sa
    password: ${DB_PASSWORD:}
  
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop
    show-sql: false
  
  # Kafka configuration (uses env vars from ConfigMap)
  cloud:
    stream:
      kafka:
        binder:
          brokers: ${KAFKA_BROKERS:kafka-service:9092}

# External service configuration (k8s service discovery)
inventory-service:
  url: ${INVENTORY_SERVICE_URL:http://inventory-service:8081}

# Feign client configuration
feign:
  client:
    config:
      inventory-service:
        connectTimeout: ${FEIGN_CLIENT_CONFIG_INVENTORY_SERVICE_CONNECTTIMEOUT:5000}
        readTimeout: ${FEIGN_CLIENT_CONFIG_INVENTORY_SERVICE_READTIMEOUT:10000}

# Actuator configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
      probes:
        enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true
  metrics:
    tags:
      application: ${spring.application.name}
      environment: k8s

# Distributed tracing with Zipkin
management.zipkin.tracing:
  endpoint: ${ZIPKIN_BASE_URL:http://zipkin-service:9411}/api/v2/spans

management.tracing:
  sampling:
    probability: 1.0

# Logging configuration
logging:
  level:
    root: ${LOGGING_LEVEL_ROOT:INFO}
    com.ecommerce: ${LOGGING_LEVEL_ECOMMERCE:DEBUG}
  pattern:
    console: ""  # Disable default pattern (logback-spring.xml handles JSON)
