# Penetration Testing Prompts

**Last Updated:** 2026-01-20  
**Status:** APPROVED - Safe Security Testing Guidance  
**Purpose:** Context engineering for defensive security analysis

---

## ⚠️ CRITICAL SAFETY NOTICE

**This document contains DEFENSIVE security testing prompts only.**

**PROHIBITED ACTIVITIES:**
- Real-world exploitation of systems without authorization
- Targeting production systems
- Bypassing authentication for malicious purposes
- Sharing exploitation techniques with unauthorized parties
- Using prompts against systems you do not own/operate

**PERMITTED ACTIVITIES:**
- Testing YOUR OWN local development environment
- Learning defensive security concepts
- Identifying vulnerabilities in code YOU control
- Security training and education

---

## 1. Threat Modeling Templates

### 1.1 STRIDE Threat Model

**Prompt for AI Security Analysis:**

```
Analyze the following microservice architecture for STRIDE threats:

Architecture:
- API Gateway (Spring Cloud Gateway) with JWT validation
- order-service (Spring Boot, REST API)
- inventory-service (Spring Boot, REST API)
- Kafka for async messaging
- H2 in-memory database
- Keycloak for authentication (realm: example)

Please identify threats in these categories:
1. Spoofing: How could an attacker impersonate a user or service?
2. Tampering: What data could be modified in transit or at rest?
3. Repudiation: What actions lack audit logging?
4. Information Disclosure: What sensitive data could leak?
5. Denial of Service: What components are vulnerable to overload?
6. Elevation of Privilege: How could an attacker gain unauthorized access?

For each threat, provide:
- Likelihood (Low/Medium/High)
- Impact (Low/Medium/High)
- Mitigation strategy
```

### 1.2 Attack Tree Analysis

**Prompt for Identifying Attack Paths:**

```
Generate an attack tree for the goal: "Unauthorized access to other users' orders"

Root Goal: Access order data belonging to another user

Please identify:
1. All possible attack vectors
2. Prerequisites for each attack
3. Attack complexity (Easy/Medium/Hard)
4. Current defenses
5. Recommended mitigations

Consider these attack paths:
- Direct API access bypassing authentication
- JWT token theft or forgery
- SQL injection
- IDOR (Insecure Direct Object Reference)
- Gateway bypass
- Service-to-service auth weakness
```

---

## 2. Security Test Scenarios

### 2.1 Authentication Bypass Testing

**Safe Testing Checklist (Local Environment Only):**

1. **Missing Token Test:**
   ```bash
   # Expected: 401 Unauthorized
   curl -X GET http://localhost:8080/api/v1/orders
   ```

2. **Invalid Token Test:**
   ```bash
   # Expected: 401 Unauthorized
   curl -X GET http://localhost:8080/api/v1/orders \
     -H "Authorization: Bearer invalid.jwt.token"
   ```

3. **Expired Token Test:**
   ```bash
   # Generate expired token (modify exp claim)
   # Expected: 401 Unauthorized
   curl -X GET http://localhost:8080/api/v1/orders \
     -H "Authorization: Bearer $EXPIRED_TOKEN"
   ```

4. **Wrong Signature Test:**
   ```bash
   # Modify JWT signature
   # Expected: 401 Unauthorized
   curl -X GET http://localhost:8080/api/v1/orders \
     -H "Authorization: Bearer $TAMPERED_TOKEN"
   ```

5. **Algorithm Confusion Test:**
   ```bash
   # Change JWT alg from RS256 to none
   # Expected: 401 Unauthorized
   # (Spring Security MUST reject "none" algorithm)
   ```

### 2.2 Authorization Bypass Testing

**IDOR (Insecure Direct Object Reference) Tests:**

1. **Access Other User's Order:**
   ```bash
   # User A creates order → receives orderId
   # User B tries to access orderId
   # Expected: 403 Forbidden or 404 Not Found
   curl -X GET http://localhost:8080/api/v1/orders/{orderId_of_user_A} \
     -H "Authorization: Bearer $USER_B_TOKEN"
   ```

2. **Admin Endpoint Access (Non-Admin):**
   ```bash
   # Expected: 403 Forbidden
   curl -X GET http://localhost:8080/api/v1/orders/admin/stats \
     -H "Authorization: Bearer $CUSTOMER_TOKEN"
   ```

3. **Role Elevation Test:**
   ```bash
   # Modify JWT roles claim (requires JWT secret, should fail)
   # Expected: 401 (invalid signature)
   ```

### 2.3 Injection Testing

**SQL Injection Tests:**

1. **Order Query Injection:**
   ```bash
   # Expected: Input sanitization prevents injection
   curl -X GET "http://localhost:8080/api/v1/orders?status=PENDING' OR '1'='1" \
     -H "Authorization: Bearer $TOKEN"
   ```

2. **Search Parameter Injection:**
   ```bash
   # Expected: Parameterized queries prevent injection
   curl -X GET "http://localhost:8080/api/v1/orders?userId=123; DROP TABLE orders;--" \
     -H "Authorization: Bearer $TOKEN"
   ```

**NoSQL Injection (if using NoSQL):**
```bash
# Expected: Input validation rejects malformed JSON
curl -X POST http://localhost:8080/api/v1/orders \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"userId": {"$ne": null}}'
```

### 2.4 Header Injection Testing

**X-User-Id Injection (Client → Gateway):**

```bash
# Client tries to forge identity
# Expected: Gateway strips this header
curl -X GET http://localhost:8080/api/v1/orders \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-User-Id: 00000000-0000-0000-0000-000000000001"
```

**Service Impersonation:**
```bash
# Client tries to impersonate service
# Expected: Rejected (requires service JWT or gateway strips header)
curl -X POST http://localhost:8082/api/v1/inventory/123/reserve \
  -H "X-Service-Name: order-service" \
  -H "Content-Type: application/json" \
  -d '{"quantity": 999}'
```

### 2.5 Rate Limiting Tests

**Brute Force Simulation:**
```bash
# Test rate limiting on login endpoint
for i in {1..100}; do
  curl -X POST http://localhost:8080/api/v1/identity/login \
    -H "Content-Type: application/json" \
    -d '{"username":"test@example.com","password":"wrong"}' &
done
wait

# Expected: 429 Too Many Requests after threshold
```

---

## 3. Vulnerability Checklists

### 3.1 OWASP Top 10 Checklist

**AI Analysis Prompt:**

```
Review this microservice implementation against OWASP Top 10 2021:

A01: Broken Access Control
- [ ] IDOR vulnerabilities in order/inventory endpoints?
- [ ] Missing authorization checks?
- [ ] Can users access others' resources?

A02: Cryptographic Failures
- [ ] Sensitive data in logs?
- [ ] Secrets hardcoded in code?
- [ ] HTTPS enforced in production?
- [ ] JWT secrets properly secured?

A03: Injection
- [ ] SQL injection possible?
- [ ] NoSQL injection possible?
- [ ] Command injection in system calls?
- [ ] Parameterized queries used?

A04: Insecure Design
- [ ] Lack of rate limiting?
- [ ] No CSRF protection (if stateful)?
- [ ] Missing input validation?

A05: Security Misconfiguration
- [ ] Default credentials used?
- [ ] Unnecessary features enabled?
- [ ] Error messages expose internals?
- [ ] Security headers missing?

A06: Vulnerable Components
- [ ] Dependencies with known CVEs?
- [ ] Outdated Spring Boot version?
- [ ] Unpatched libraries?

A07: Identification & Authentication Failures
- [ ] Weak JWT configuration?
- [ ] Missing token expiration?
- [ ] Insufficient password policy?
- [ ] No brute force protection?

A08: Software & Data Integrity Failures
- [ ] Unsigned JWTs accepted?
- [ ] No integrity checks on events?
- [ ] Deserialization vulnerabilities?

A09: Security Logging & Monitoring Failures
- [ ] Authentication failures logged?
- [ ] No alerting on suspicious activity?
- [ ] Logs contain sensitive data?

A10: Server-Side Request Forgery (SSRF)
- [ ] User-controlled URLs?
- [ ] No URL validation?
```

### 3.2 JWT Security Checklist

**Validation Checklist:**
- [ ] Signature validated (RS256 or HS256)
- [ ] Expiration checked (exp claim)
- [ ] Issuer validated (iss claim)
- [ ] Audience validated (aud claim, if used)
- [ ] Not Before checked (nbf claim, if used)
- [ ] Algorithm whitelist enforced (no "none")
- [ ] JTI (JWT ID) tracked for revocation (optional)
- [ ] Claims validated (roles, permissions)

**AI Review Prompt:**
```
Review this Spring Security JWT configuration for security issues:

[Paste configuration code]

Check for:
1. Algorithm vulnerabilities (none, weak alg)
2. Missing validation steps
3. Token lifetime issues
4. Key management problems
5. Common JWT pitfalls
```

---

## 4. Remediation Guidance

### 4.1 Common Vulnerability Fixes

**Problem:** IDOR vulnerability (access others' orders)

**Fix:**
```java
// BAD: No ownership check
@GetMapping("/api/v1/orders/{orderId}")
public OrderDto getOrder(@PathVariable UUID orderId) {
    return orderService.findById(orderId);
}

// GOOD: Verify ownership
@GetMapping("/api/v1/orders/{orderId}")
public OrderDto getOrder(
    @PathVariable UUID orderId, 
    @RequestHeader("X-User-Id") UUID userId
) {
    Order order = orderService.findById(orderId);
    
    if (!order.getUserId().equals(userId) && !isAdmin()) {
        throw new ForbiddenException("Cannot access this order");
    }
    
    return toDto(order);
}
```

**Problem:** SQL Injection

**Fix:**
```java
// BAD: String concatenation
String query = "SELECT * FROM orders WHERE status = '" + status + "'";

// GOOD: Parameterized query (JPA)
@Query("SELECT o FROM Order o WHERE o.status = :status")
List<Order> findByStatus(@Param("status") OrderStatus status);
```

**Problem:** Missing rate limiting

**Fix:** See [rate-limits.md](rate-limits.md) for implementation.

### 4.2 Security Hardening Steps

**AI Guidance Prompt:**

```
Provide security hardening recommendations for this Spring Boot microservice:

Current setup:
- Spring Boot 3.x
- Spring Security with OAuth2 Resource Server
- JWT authentication
- H2 database (dev)
- Actuator endpoints enabled

Please recommend:
1. Security headers to add
2. Actuator endpoint restrictions
3. CORS policy improvements
4. Logging & monitoring enhancements
5. Dependency security scanning tools
```

---

## 5. Secure Code Review Prompts

### 5.1 General Security Review

**Prompt for AI Code Review:**

```
Perform a security review of this code:

[Paste code]

Focus on:
1. Authentication/Authorization flaws
2. Input validation issues
3. Injection vulnerabilities
4. Sensitive data exposure
5. Error handling problems
6. Race conditions
7. Logic flaws

For each issue found, provide:
- Severity (Critical/High/Medium/Low)
- Explanation
- Fix recommendation
```

### 5.2 Specific Component Reviews

**Controller Security Review:**
```
Review this REST controller for security issues:

[Paste controller code]

Check for:
- Missing authentication
- Authorization bypass (IDOR)
- Input validation gaps
- Mass assignment vulnerabilities
- Information leakage in responses
```

**Service Layer Review:**
```
Review this service class for security issues:

[Paste service code]

Check for:
- Business logic flaws
- Race conditions
- Transaction boundaries
- Sensitive data handling
- External call security
```

---

## 6. Security Training Scenarios

### 6.1 Capture The Flag (CTF) Style Challenges

**Challenge 1: JWT Bypass**
```
Scenario: Can you access admin endpoints without admin role?

Setup:
- User token with role: customer
- Admin endpoint: /api/v1/orders/admin/stats

Task: Identify why the following attack fails
[Include example attack]

Learning Objective: Understanding JWT signature validation
```

**Challenge 2: IDOR Discovery**
```
Scenario: Find the IDOR vulnerability

Given:
- Two user accounts (Alice, Bob)
- Order creation endpoint
- Order retrieval endpoint

Task: Demonstrate how Bob can access Alice's order (if vulnerable)

Fix: Implement proper authorization
```

### 6.2 Defensive Coding Exercises

**Exercise 1: Fix the Vulnerability**
```
Given this vulnerable code:

[Paste vulnerable code]

Tasks:
1. Identify the vulnerability
2. Explain the risk
3. Implement a fix
4. Write a test to prove the fix works
```

---

## 7. Automated Security Testing

### 7.1 Dependency Scanning

**OWASP Dependency-Check (Maven):**
```xml
<plugin>
    <groupId>org.owasp</groupId>
    <artifactId>dependency-check-maven</artifactId>
    <version>8.4.0</version>
    <executions>
        <execution>
            <goals>
                <goal>check</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

**Run:**
```bash
mvn dependency-check:check
```

### 7.2 Static Analysis (SpotBugs + Security Rules)

**Configuration:**
```xml
<plugin>
    <groupId>com.github.spotbugs</groupId>
    <artifactId>spotbugs-maven-plugin</artifactId>
    <version>4.8.0.0</version>
    <dependencies>
        <dependency>
            <groupId>com.h3xstream.findsecbugs</groupId>
            <artifactId>findsecbugs-plugin</artifactId>
            <version>1.12.0</version>
        </dependency>
    </dependencies>
</plugin>
```

### 7.3 Dynamic Application Security Testing (DAST)

**OWASP ZAP Baseline Scan:**
```bash
docker run -v $(pwd):/zap/wrk:rw \
  -t owasp/zap2docker-stable \
  zap-baseline.py \
  -t http://localhost:8080/api/v1 \
  -r zap-report.html
```

---

## 8. Incident Response Prompts

### 8.1 Security Incident Analysis

**AI Prompt for Log Analysis:**

```
Analyze these logs for security incidents:

[Paste logs]

Identify:
1. Failed authentication attempts
2. Unusual access patterns
3. Potential brute force attacks
4. Authorization failures
5. Injection attempts

Provide:
- Timeline of events
- Affected resources
- Recommended immediate actions
- Long-term remediation
```

### 8.2 Breach Simulation

**Prompt for Incident Response Planning:**

```
Simulate a security breach scenario:

Scenario: An attacker gained access to a valid JWT token

Questions:
1. What actions could the attacker take?
2. How long is the attacker's access valid?
3. How can we detect this compromise?
4. What is the immediate response?
5. How do we prevent future occurrences?

Provide incident response playbook.
```

---

## 9. Compliance & Audit Prompts

### 9.1 Security Audit Checklist

**AI Audit Assistant Prompt:**

```
Perform a security audit of this microservice architecture:

[Describe architecture]

Audit areas:
1. Authentication mechanisms
2. Authorization controls
3. Data encryption (in-transit, at-rest)
4. Audit logging
5. API security
6. Secrets management
7. Network segmentation
8. Incident response readiness

Provide:
- Compliance findings (Pass/Fail)
- Risk assessment
- Remediation recommendations
- Priority ranking
```

---

## 10. Continuous Security Monitoring

### 10.1 Security Metrics Prompt

**Prompt for Security Dashboard Design:**

```
Design a security monitoring dashboard for this microservice ecosystem.

Metrics to track:
1. Authentication failures per minute
2. Authorization denials per user
3. Rate limit breaches
4. Anomalous access patterns
5. Token expiration/refresh rates
6. Vulnerability scan results
7. Dependency update lag

For each metric, provide:
- Collection method
- Alert thresholds
- Visualization recommendation
```

---

**END OF PENTEST-PROMPTS.MD**
